# Backend для анализа комет (Astronomy Comet Analysis API)

Данный backend представляет собой API для астрономических расчетов, связанных с кометами. Он реализован с использованием FastAPI и включает в себя модули для обработки данных, выполнения расчетов и логирования.

---

## Структура проекта

```
backend/
├── main.py                      # Точка входа в приложение FastAPI
├── requirements.txt             # Зависимости проекта
├── app/
│   ├── api/
│   │   ├── endpoints.py         # Определение API маршрутов и логики обработки запросов
│   │   └── schemas.py           # Pydantic схемы для валидации данных API (не детализировано)
│   ├── core/
│   │   ├── calculations/        # Модули расчетов (масса, ядро, сублимация)
│   │   │   ├── mass.py          # Расчет массы кометы
│   │   │   ├── nucleus.py       # Расчет параметров ядра кометы
│   │   │   ├── sublimation.py   # Расчет сублимации кометы
│   │   │   └── cpp_loader.py    # Загрузка и интеграция C++ расчетов (если применимо)
│   │   └── services/            # Сервисы поддержки
│   │       ├── config.py        # Конфигурация приложения (не детализировано)
│   │       ├── file_parser.py   # Парсинг загружаемых файлов (TXT, FITS)
│   │       └── logger.py        # Настройка логирования
├── cpp/                         # C++ исходники для высокопроизводительных расчетов
│   ├── core/
│   │   ├── mass.cpp
│   │   ├── nucleus.cpp
│   │   ├── sublimation.cpp
│   ├── include/
│   │   ├── mass.h
│   │   ├── nucleus.h
│   │   ├── sublimation.h
│   └── CMakeLists.txt           # Сборка C++ модулей
├── tests/                       # Тесты (например, test_sublimation.py)
└── CMakeLists.txt               # Сборка проекта (включая C++ части)
```

---

## Основные компоненты

### main.py

- Запускает FastAPI приложение с названием "Astronomy Comet Analysis API".
- Настраивает логирование.
- Подключает маршруты API с префиксом `/api`.
- Определяет корневой маршрут `/` для проверки работоспособности API.

### API (app/api/endpoints.py)

- Предоставляет POST эндпоинт `/api/calculate` для выполнения расчетов по типам:
  - `sublimation` — расчет сублимации кометы.
  - `mass` — расчет массы кометы.
  - `nucleus` — расчет параметров ядра кометы.
- Принимает загружаемый файл с данными кометы (форматы TXT или FITS).
- Принимает параметры расчета в формате JSON.
- Возвращает результат расчета с значением, единицами измерения и ошибкой (если есть).

### Модули расчетов (app/core/calculations)

- Реализуют алгоритмы для различных астрономических расчетов.
- Пример: `mass.py` вычисляет массу кометы по фотометрической формуле, используя данные о звездной величине и расстояниях.
- Используют данные, полученные из загруженных файлов.

### Сервисы (app/core/services)

- `file_parser.py` — парсит загруженные файлы в формате TXT и FITS, извлекая необходимые данные (дни до перигелия, звездная величина, Afrho).
- `logger.py` — настраивает логирование с выводом ошибок в файлы и информационных сообщений в консоль.
- `config.py` — содержит конфигурационные параметры (детали не раскрыты).

### C++ модули (backend/cpp)

- Высокопроизводительные реализации расчетов, интегрируемые с Python.
- Содержат исходники и заголовочные файлы для расчетов массы, ядра и сублимации.
- Сборка осуществляется через CMake.

---

## Запуск проекта

1. Установить зависимости из `requirements.txt`.
2. Запустить backend командой:
   ```
   uvicorn backend.main:app --host 0.0.0.0 --port 8000
   ```
3. API будет доступен по адресу `http://localhost:8000/api`.

---

## Логирование

- Логи ошибок сохраняются в папку `logs` с ежедневным разделением по файлам.
- Информационные сообщения выводятся в консоль.

---

## Тестирование

- Тесты расположены в папке `tests`.
- Пример теста: `test_sublimation.py`.

---

## Примечания

- Для корректной работы API необходимо загружать файлы в формате TXT или FITS с необходимыми колонками данных.
- Расчеты основаны на астрономических формулах и данных, загружаемых пользователем.

---